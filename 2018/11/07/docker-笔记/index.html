<html>
<head><meta name="generator" content="Hexo 3.8.0">
	
	<title>docker 笔记</title>
	<meta name="keywords" content="刘洋,刘洋的blog">

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
	   <link href="/css/main.css?v=3" rel="stylesheet" type="text/css">
    
        <script src="/js/util.js"></script>
        <script>
            if(isMobile()) {
                loadjscssfile('../css/mobile.css', 'css');
            } else {
                loadjscssfile('../css/desktop.css', 'css');
            }
        </script> 
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3">
    
    

</head>

<body>


<h2 class="title">docker 笔记</h2>
<!---
<div style="text-align:center;margin-top: -10px;">
<div class="article-category">
发表于2018年11月7日


    <a class="article-category-link" href="/categories/学习/">学习</a>



 </div>
--->


<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker安装"><span class="toc-text">docker安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于dockerfile使用docker-build-创建images"><span class="toc-text">基于dockerfile使用docker build 创建images</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于image运行docker容器同时运行指定主机端口"><span class="toc-text">基于image运行docker容器同时运行指定主机端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于image运行docker容器同时运行指定主机端口且挂载外部目录，且出错重启"><span class="toc-text">基于image运行docker容器同时运行指定主机端口且挂载外部目录，且出错重启</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#进入到容器内部可以修改相关配置-不使用attach，attach方式因为退出，导致整个容器退出"><span class="toc-text">进入到容器内部可以修改相关配置,不使用attach，attach方式因为退出，导致整个容器退出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除镜像-删除容器是rm"><span class="toc-text">删除镜像.删除容器是rm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#把打包的镜像上传到仓库"><span class="toc-text">把打包的镜像上传到仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#服务的启动命令"><span class="toc-text">服务的启动命令</span></a></li></ol>
<h3 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> step 1: 安装必要的一些系统工具</span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="meta">#</span> Step 2: 添加软件源信息</span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span> Step 3: 更新并安装 Docker-CE</span><br><span class="line">sudo yum makecache fast</span><br><span class="line">sudo yum -y install docker-ce</span><br><span class="line"><span class="meta">#</span> Step 4: 开启Docker服务</span><br><span class="line">sudo service docker start</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看安装的版本</span><br><span class="line">docker version [-f &#123;&#123;.Server.Version&#125;&#125;]</span><br><span class="line">docker info</span><br></pre></td></tr></table></figure>
<h3 id="基于dockerfile使用docker-build-创建images"><a href="#基于dockerfile使用docker-build-创建images" class="headerlink" title="基于dockerfile使用docker build 创建images"></a>基于dockerfile使用docker build 创建images</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line">docker build . -t 需要打包成的镜像名称  </span><br><span class="line"><span class="meta">#</span>备注：.代表dockerfile在当前目录,以dockerfile为准  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker build . -t liimages/spider1.0</span><br></pre></td></tr></table></figure>
<h3 id="基于image运行docker容器同时运行指定主机端口"><a href="#基于image运行docker容器同时运行指定主机端口" class="headerlink" title="基于image运行docker容器同时运行指定主机端口"></a>基于image运行docker容器同时运行指定主机端口</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line">docker run -d -p 主机端口:容器端口 镜像名称或者Id  </span><br><span class="line"><span class="meta">#</span>备注：-d:后台运行,-p 暴露端口  </span><br><span class="line"><span class="meta">#</span>4000:80的意思是容器的80的端口映射到主机的4000端口 外部以400端口访问</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker run -d -p 4000:80 liimages/spider1.0</span><br></pre></td></tr></table></figure>
<h3 id="基于image运行docker容器同时运行指定主机端口且挂载外部目录，且出错重启"><a href="#基于image运行docker容器同时运行指定主机端口且挂载外部目录，且出错重启" class="headerlink" title="基于image运行docker容器同时运行指定主机端口且挂载外部目录，且出错重启"></a>基于image运行docker容器同时运行指定主机端口且挂载外部目录，且出错重启</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line">-v 参数：  </span><br><span class="line"><span class="meta">#</span>冒号前为宿主机目录，必须为绝对路径，冒号后为镜像内挂载的路径。  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker run --restart=always -itdp 1230:1235 -v /etc/localtime:/etc/localtime:ro liimages/spider2.0 ./run.sh</span><br></pre></td></tr></table></figure>
<h3 id="进入到容器内部可以修改相关配置-不使用attach，attach方式因为退出，导致整个容器退出"><a href="#进入到容器内部可以修改相关配置-不使用attach，attach方式因为退出，导致整个容器退出" class="headerlink" title="进入到容器内部可以修改相关配置,不使用attach，attach方式因为退出，导致整个容器退出"></a>进入到容器内部可以修改相关配置,不使用attach，attach方式因为退出，导致整个容器退出</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line">docker exec -it 容器名称或者容器Id /bin/sh  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker exec -it bb2 /bin/sh</span><br></pre></td></tr></table></figure>
<h3 id="删除镜像-删除容器是rm"><a href="#删除镜像-删除容器是rm" class="headerlink" title="删除镜像.删除容器是rm"></a>删除镜像.删除容器是rm</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line">格式一：docker rmi 镜像名或者镜像Id  </span><br><span class="line">格式二：docker rmi -f 镜像名或者镜像Id  </span><br><span class="line"><span class="meta">#</span>备注：强制删除与该镜像有关的容器（包括启动中的）和该镜像  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker rmi liimages/spider2.0</span><br></pre></td></tr></table></figure>
<h3 id="把打包的镜像上传到仓库"><a href="#把打包的镜像上传到仓库" class="headerlink" title="把打包的镜像上传到仓库"></a>把打包的镜像上传到仓库</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line"><span class="meta">#</span>前提1：镜像的名字要符合官方标准  </span><br><span class="line"><span class="meta">#</span>前提2：使用docker login 登录  </span><br><span class="line">格式：docker push 镜像名  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker push 镜像名</span><br></pre></td></tr></table></figure>
<h3 id="服务的启动命令"><a href="#服务的启动命令" class="headerlink" title="服务的启动命令"></a>服务的启动命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>mysql的启动命令  </span><br><span class="line">docker run --restart=always --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=mypassword -d docker.io/mysql   </span><br><span class="line"><span class="meta">#</span>启动一个mysql  </span><br><span class="line"><span class="meta">#</span>其中--restart=always是自动启动的意思  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>redis的启动命令  </span><br><span class="line">docker run --restart=always  -p 6379:6379 --name redis -d redis redis-server --appendonly yes --requirepass mypassword  </span><br><span class="line"><span class="meta">#</span>其中：--appendonly yes是持久化数据的意思  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>安装gitlab  </span><br><span class="line"><span class="meta">#</span>dock查找镜像  </span><br><span class="line">docker search gitlab  </span><br><span class="line"><span class="meta">#</span>下载汉化的社区版本  </span><br><span class="line">docker pull  twang2218/gitlab-ce-zh  </span><br><span class="line"><span class="meta">#</span>下载好之后运行镜像  </span><br><span class="line">docker run -d -p 8888:80 --restart=always --name gitlab twang2218/gitlab-ce-zh  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>安装mongo</span><br><span class="line">docker search mongo</span><br><span class="line">docker pull  mongo</span><br><span class="line"><span class="meta">#</span>这里的--name 放在前面并映射端口</span><br><span class="line">docker run --name mongo -p 27017:27017 -d mongo --auth</span><br><span class="line"><span class="meta">#</span>进入容器</span><br><span class="line">docker exec -it mongo bash</span><br><span class="line"><span class="meta">#</span>auth</span><br><span class="line">mongo</span><br><span class="line">use admin</span><br><span class="line"><span class="meta">#</span>创建用户,此用户创建成功,则后续操作都需要用户认证</span><br><span class="line">db.createUser(&#123;user:"root",pwd:"root",roles:[&#123;role:'root',db:'admin'&#125;]&#125;)</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>


<!--<a href="http://yoursite.com/2018/11/07/docker-笔记/#disqus_thread" class="article-comment-link">Comments</a>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->
<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script>
</div>






</body>
</html>
<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> docker 笔记 · 刘洋的博客</title><meta name="description" content="docker 笔记 - 刘洋@liuyang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico?v=2018"><link rel="stylesheet" href="/css/style.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="刘洋的博客"></head><body><div class="wrap"><header><h1 class="title">Jeremy's Blog</h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">主页</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">归档</a></li><li class="nav-list-item"><a class="nav-list-link" href="http://jeremyfan.name" target="_blank">关于</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">docker 笔记</h1><div class="post-info">Nov 7, 2018</div><div class="post-content"><blockquote>
<p>docker的环境搭建以及使用<br><a id="more"></a></p>
</blockquote>
<h3 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> step 1: 安装必要的一些系统工具</span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="meta">#</span> Step 2: 添加软件源信息</span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span> Step 3: 更新并安装 Docker-CE</span><br><span class="line">sudo yum makecache fast</span><br><span class="line">sudo yum -y install docker-ce</span><br><span class="line"><span class="meta">#</span> Step 4: 开启Docker服务</span><br><span class="line">sudo service docker start</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看安装的版本</span><br><span class="line">docker version [-f &#123;&#123;.Server.Version&#125;&#125;]</span><br><span class="line">docker info</span><br></pre></td></tr></table></figure>
<h3 id="基于dockerfile使用docker-build-创建images"><a href="#基于dockerfile使用docker-build-创建images" class="headerlink" title="基于dockerfile使用docker build 创建images"></a>基于dockerfile使用docker build 创建images</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line">docker build . -t 需要打包成的镜像名称  </span><br><span class="line"><span class="meta">#</span>备注：.代表dockerfile在当前目录,以dockerfile为准  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker build . -t liimages/spider1.0</span><br></pre></td></tr></table></figure>
<h3 id="基于image运行docker容器同时运行指定主机端口"><a href="#基于image运行docker容器同时运行指定主机端口" class="headerlink" title="基于image运行docker容器同时运行指定主机端口"></a>基于image运行docker容器同时运行指定主机端口</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line">docker run -d -p 主机端口:容器端口 镜像名称或者Id  </span><br><span class="line"><span class="meta">#</span>备注：-d:后台运行,-p 暴露端口  </span><br><span class="line"><span class="meta">#</span>4000:80的意思是容器的80的端口映射到主机的4000端口 外部以400端口访问</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker run -d -p 4000:80 liimages/spider1.0</span><br></pre></td></tr></table></figure>
<h3 id="基于image运行docker容器同时运行指定主机端口且挂载外部目录，且出错重启"><a href="#基于image运行docker容器同时运行指定主机端口且挂载外部目录，且出错重启" class="headerlink" title="基于image运行docker容器同时运行指定主机端口且挂载外部目录，且出错重启"></a>基于image运行docker容器同时运行指定主机端口且挂载外部目录，且出错重启</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line">-v 参数：  </span><br><span class="line"><span class="meta">#</span>冒号前为宿主机目录，必须为绝对路径，冒号后为镜像内挂载的路径。  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker run --restart=always -itdp 1230:1235 -v /etc/localtime:/etc/localtime:ro liimages/spider2.0 ./run.sh</span><br></pre></td></tr></table></figure>
<h3 id="进入到容器内部可以修改相关配置-不使用attach，attach方式因为退出，导致整个容器退出"><a href="#进入到容器内部可以修改相关配置-不使用attach，attach方式因为退出，导致整个容器退出" class="headerlink" title="进入到容器内部可以修改相关配置,不使用attach，attach方式因为退出，导致整个容器退出"></a>进入到容器内部可以修改相关配置,不使用attach，attach方式因为退出，导致整个容器退出</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line">docker exec -it 容器名称或者容器Id /bin/sh  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker exec -it bb2 /bin/sh</span><br></pre></td></tr></table></figure>
<h3 id="删除镜像-删除容器是rm"><a href="#删除镜像-删除容器是rm" class="headerlink" title="删除镜像.删除容器是rm"></a>删除镜像.删除容器是rm</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line">格式一：docker rmi 镜像名或者镜像Id  </span><br><span class="line">格式二：docker rmi -f 镜像名或者镜像Id  </span><br><span class="line"><span class="meta">#</span>备注：强制删除与该镜像有关的容器（包括启动中的）和该镜像  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker rmi liimages/spider2.0</span><br></pre></td></tr></table></figure>
<h3 id="把打包的镜像上传到仓库"><a href="#把打包的镜像上传到仓库" class="headerlink" title="把打包的镜像上传到仓库"></a>把打包的镜像上传到仓库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>格式  </span><br><span class="line"><span class="meta">#</span>前提1：镜像的名字要符合官方标准  </span><br><span class="line"><span class="meta">#</span>前提2：使用docker login 登录  </span><br><span class="line">格式：docker push 镜像名  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>示例  </span><br><span class="line">docker push 镜像名</span><br></pre></td></tr></table></figure>
<h3 id="服务的启动命令"><a href="#服务的启动命令" class="headerlink" title="服务的启动命令"></a>服务的启动命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>mysql的启动命令  </span><br><span class="line">docker run --restart=always --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=mypassword -d docker.io/mysql   </span><br><span class="line"><span class="meta">#</span>启动一个mysql  </span><br><span class="line"><span class="meta">#</span>其中--restart=always是自动启动的意思  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>redis的启动命令  </span><br><span class="line">docker run --restart=always  -p 6379:6379 --name redis -d redis redis-server --appendonly yes --requirepass mypassword  </span><br><span class="line"><span class="meta">#</span>其中：--appendonly yes是持久化数据的意思  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>安装gitlab  </span><br><span class="line"><span class="meta">#</span>dock查找镜像  </span><br><span class="line">docker search gitlab  </span><br><span class="line"><span class="meta">#</span>下载汉化的社区版本  </span><br><span class="line">docker pull  twang2218/gitlab-ce-zh  </span><br><span class="line"><span class="meta">#</span>下载好之后运行镜像  </span><br><span class="line">docker run -d -p 8888:80 --restart=always --name gitlab twang2218/gitlab-ce-zh  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>安装mongo</span><br><span class="line">docker search mongo</span><br><span class="line">docker pull  mongo</span><br><span class="line"><span class="meta">#</span>这里的--name 放在前面并映射端口</span><br><span class="line">docker run --name mongo -p 27017:27017 -d mongo --auth</span><br><span class="line"><span class="meta">#</span>进入容器</span><br><span class="line">docker exec -it mongo bash</span><br><span class="line"><span class="meta">#</span>auth</span><br><span class="line">mongo</span><br><span class="line">use admin</span><br><span class="line"><span class="meta">#</span>创建用户,此用户创建成功,则后续操作都需要用户认证</span><br><span class="line">db.createUser(&#123;user:"root",pwd:"root",roles:[&#123;role:'root',db:'admin'&#125;]&#125;)</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2018/11/13/k8s测试环境集群搭建/">上一篇</a><a class="next" href="/2018/11/05/nsq的使用/">下一篇</a></div><div class="copyright"><p>© 2017 - 2018 PEACE & LOVE</p><p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>, <a href="https://github.com/jeremyfan/hexo-theme-still" target="_blank">theme</a> by <a href="https://github.com/jeremyfan" target="_blank">刘洋@liuyang</a>.</p></div></footer></div></body></html>